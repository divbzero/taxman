<!DOCTYPE html>

<head>
  <meta charset=utf-8>
  <title>Taxman</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      font-size: 14px;
      cursor: default;
    }

    fieldset {
      border: 0;
      margin: 1em 0;
    }
    legend {
      color: #555;
      font-size: 84%;
      font-weight: bold;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    input,
    label {
      display: inline-block;
      height: 1.2em;
      padding: 0.5em 0.8em;
      border-radius: 0.2em;
    }

    .toggle {
      display: inline-block;
      margin: 0.2em 0;
      vertical-align: top;
    }
    .toggle input {
      display: none;
    }
    .toggle label {
      background-color: #eee;
      cursor: pointer;
    }
    .toggle label:hover {
      background-color: #ddd;
    }
    .toggle label:active {
      background-color: #ccc;
    }
    .toggle input:checked + label {
      background-color: #6d6;
      color: #fff;
    }
    .toggle input:checked + label:hover {
      background-color: #4c4;
    }
    .toggle input:checked + label:active {
      background-color: #2b2;
    }

    .input {
      display: inline-block;
      margin: 0.1em 0;
      vertical-align: top;
    }
    .input label.unit {
      border: thin solid #ddd;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      margin-right: -0.5em;
      background-color: #eee;
    }
    .input input {
      padding-right: 0.2em;
      border: thin solid #ddd;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      font-size: inherit;
    }
    .input input + label {
      display: block;
      padding: 0.3em;
      color: #555;
      font-size: 84%;
    }
  </style>
</head>

<body>
  <form>
    <fieldset>
      <legend>Tax Plan</legend>
      <span class=toggle>
        <input type=radio id=plan-2017 name=plan value=2017 checked>
        <label for=plan-2017>2017</label>
      </span>
      <span class=toggle>
        <input type=radio id=plan-2018-house name=plan value=2018-house>
        <label for=plan-2018-house>2018 (House)</label>
      </span>
      <span class=toggle>
        <input type=radio id=plan-2018-senate name=plan value=2018-senate>
        <label for=plan-2018-senate>2018 (Senate)</label>
      </span>
    </fieldset>

    <fieldset>
      <legend>Filing Status</legend>
      <span class=toggle>
        <input type=radio id=status-single name=status value=single checked>
        <label for=status-single>Single</label>
      </span>
      <span class=toggle>
        <input type=radio id=status-joint name=status value=joint>
        <label for=status-joint>Married filing jointly</label>
      </span>
      <span class=toggle>
        <input type=radio id=status-separate name=status value=separate>
        <label for=status-separate>Married filing separately</label>
      </span>
      <span class=toggle>
        <input type=radio id=status-household name=status value=household>
        <label for=status-household>Head of household</label>
      </span>
    </fieldset>

    <fieldset>
      <legend>Income</legend>
      <span class=input>
        <label class=unit for=income>$</label>
        <input type=number id=income name=income step=1000 value=30000>
        <label for=income>Ordinary income less adjustments</label>
      </span>
    </fieldset>

    <fieldset>
      <legend>Deduction</legend>
      <span class=toggle>
        <input type=radio id=deduction-type-standard name=deduction-type value=standard checked>
        <label for=deduction-type-standard>Standard</label>
      </span>
      <span class=toggle>
        <input type=radio id=deduction-type-itemized name=deduction-type value=itemized>
        <label for=deduction-type-itemized>Itemized</label>
      </span>
      <span class=input>
        <label class=unit for=deduction>$</label>
        <input id=deduction name=deduction min=0 value=6350 disabled>
        <label for=deduction>Deduction</label>
      </span>
    </fieldset>

    <fieldset>
      <legend>Exemption</legend>
      <span class=input>
        <input type=number id=dependents name=dependents value=1 min=1>
        <label for=dependents>Dependents</label>
      </span>
      <span class=input>
        <label class=unit for=exemption>$</label>
        <input id=exemption name=exemption min=0 value=4050 disabled>
        <label for=exemption>Exemption</label>
      </span>
    </fieldset>

    <fieldset>
      <legend>Taxable Income</legend>
      <span class=input>
        <label class=unit for=taxable-income>$</label>
        <input id=taxable-income name=taxable-income value=19600 disabled>
      </span>
    </fieldset>

    <fieldset>
      <legend>Income Tax</legend>
      <span class=input>
        <label class=unit for=tax>$</label>
        <input id=tax name=tax value=2474 disabled>
      </span>
    </fieldset>
  </form>

  <script>
    var rates = {
      '2017': {
        single: {
          deduction: 6350,
          exemption: 4050,
          income: [
            {min:      0, max:     9325, rate: 0.10},
            {min:   9325, max:    37950, rate: 0.15},
            {min:  37950, max:    91900, rate: 0.25},
            {min:  91900, max:   191650, rate: 0.28},
            {min: 191650, max:   416700, rate: 0.33},
            {min: 416700, max:   418400, rate: 0.35},
            {min: 418400, max: Infinity, rate: 0.396},
          ],
        },
        joint: {
          deduction: 12700,
          exemption: 4050,
          income: [
            {min:      0, max:    18650, rate: 0.10},
            {min:  18650, max:    75900, rate: 0.15},
            {min:  75900, max:   153100, rate: 0.25},
            {min: 153100, max:   233350, rate: 0.28},
            {min: 233350, max:   416700, rate: 0.33},
            {min: 416700, max:   470700, rate: 0.35},
            {min: 470700, max: Infinity, rate: 0.396},
          ],
        },
        separate: {
          deduction: 6350,
          exemption: 4050,
          income: [
            {min:      0, max:     9325, rate: 0.10},
            {min:   9325, max:    37950, rate: 0.15},
            {min:  37950, max:    76550, rate: 0.25},
            {min:  76550, max:   116675, rate: 0.28},
            {min: 116675, max:   208350, rate: 0.33},
            {min: 208350, max:   235350, rate: 0.35},
            {min: 235350, max: Infinity, rate: 0.396},
          ],
        },
        household: {
          deduction: 9350,
          exemption: 4050,
          income: [
            {min:      0, max:    13350, rate: 0.10},
            {min:  13350, max:    50800, rate: 0.15},
            {min:  50800, max:   131200, rate: 0.25},
            {min: 131200, max:   212500, rate: 0.28},
            {min: 212500, max:   416700, rate: 0.33},
            {min: 416700, max:   444550, rate: 0.35},
            {min: 444550, max: Infinity, rate: 0.396},
          ],
        },
      },
      '2018': {
        single: {
          deduction: 6350,
          exemption: 4050,
          income: [
            {min:      0, max:     9525, rate: 0.10},
            {min:   9525, max:    38700, rate: 0.15},
            {min:  38700, max:    93700, rate: 0.25},
            {min:  93700, max:   195450, rate: 0.28},
            {min: 195450, max:   424950, rate: 0.33},
            {min: 424950, max:   426700, rate: 0.35},
            {min: 426700, max: Infinity, rate: 0.396},
          ],
        },
        joint: {
          deduction: 12700,
          exemption: 4050,
          income: [
            {min:      0, max:    19050, rate: 0.10},
            {min:  19050, max:    77400, rate: 0.15},
            {min:  77400, max:   156150, rate: 0.25},
            {min: 156150, max:   237950, rate: 0.28},
            {min: 237950, max:   424950, rate: 0.33},
            {min: 424950, max:   480050, rate: 0.35},
            {min: 480050, max: Infinity, rate: 0.396},
          ],
        },
        separate: {
          deduction: 6350,
          exemption: 4050,
          income: [
            {min:      0, max:     9525, rate: 0.10},
            {min:   9525, max:    38700, rate: 0.15},
            {min:  38700, max:    78075, rate: 0.25},
            {min:  78075, max:   118975, rate: 0.28},
            {min: 118975, max:   212475, rate: 0.33},
            {min: 212475, max:   240025, rate: 0.35},
            {min: 240025, max: Infinity, rate: 0.396},
          ],
        },
        household: {
          deduction: 9350,
          exemption: 4050,
          income: [
            {min:      0, max:    13600, rate: 0.10},
            {min:  13600, max:    51850, rate: 0.15},
            {min:  51850, max:   133850, rate: 0.25},
            {min: 133850, max:   216700, rate: 0.28},
            {min: 216700, max:   424950, rate: 0.33},
            {min: 424950, max:   453350, rate: 0.35},
            {min: 453350, max: Infinity, rate: 0.396},
          ],
        },
      },
      '2018-house': {
        single: {
          deduction: 12200,
          exemption: 0,
          income: [
            {min:      0, max:    45000, rate: 0.12},
            {min:  45000, max:   200000, rate: 0.25},
            {min: 200000, max:   500000, rate: 0.35},
            {min: 500000, max: Infinity, rate: 0.396},
          ],
        },
        joint: {
          deduction: 24400,
          exemption: 0,
          income: [
            {min:       0, max:    90000, rate: 0.12},
            {min:   90000, max:   260000, rate: 0.25},
            {min:  260000, max:  1000000, rate: 0.35},
            {min: 1000000, max: Infinity, rate: 0.396},
          ],
        },
        separate: {
          deduction: 12200,
          exemption: 0,
          income: [
            {min:      0, max:    45000, rate: 0.12},
            {min:  45000, max:   130000, rate: 0.25},
            {min: 130000, max:   500000, rate: 0.35},
            {min: 500000, max: Infinity, rate: 0.396},
          ],
        },
        household: {
          deduction: 18300,
          exemption: 0,
          income: [
            {min:      0, max:    67500, rate: 0.12},
            {min:  67500, max:   200000, rate: 0.25},
            {min: 200000, max:   500000, rate: 0.35},
            {min: 500000, max: Infinity, rate: 0.396},
          ],
        },
      },
      '2018-senate': {
        single: {
          deduction: 12000,
          exemption: 0,
          income: [
            {min:      0, max:     9525, rate: 0.10},
            {min:   9525, max:    38700, rate: 0.12},
            {min:  38700, max:    70000, rate: 0.22},
            {min:  70000, max:   160000, rate: 0.24},
            {min: 160000, max:   200000, rate: 0.32},
            {min: 200000, max:   500000, rate: 0.35},
            {min: 500000, max: Infinity, rate: 0.385},
          ],
        },
        joint: {
          deduction: 24000,
          exemption: 0,
          income: [
            {min:       0, max:    19050, rate: 0.10},
            {min:   19050, max:    77400, rate: 0.12},
            {min:   77400, max:   140000, rate: 0.22},
            {min:  140000, max:   320000, rate: 0.24},
            {min:  320000, max:   400000, rate: 0.32},
            {min:  400000, max:  1000000, rate: 0.35},
            {min: 1000000, max: Infinity, rate: 0.385},
          ],
        },
        separate: {
          deduction: 12000,
          exemption: 0,
          income: [
            {min:      0, max:     9525, rate: 0.10},
            {min:   9525, max:    38700, rate: 0.12},
            {min:  38700, max:    70000, rate: 0.22},
            {min:  70000, max:   160000, rate: 0.24},
            {min: 160000, max:   200000, rate: 0.32},
            {min: 200000, max:   500000, rate: 0.35},
            {min: 500000, max: Infinity, rate: 0.385},
          ],
        },
        household: {
          deduction: 18000,
          exemption: 0,
          income: [
            {min:      0, max:    13600, rate: 0.10},
            {min:  13600, max:    51800, rate: 0.12},
            {min:  51800, max:    70000, rate: 0.22},
            {min:  70000, max:   160000, rate: 0.24},
            {min: 160000, max:   200000, rate: 0.32},
            {min: 200000, max:   500000, rate: 0.35},
            {min: 500000, max: Infinity, rate: 0.385},
          ],
        },
      },
    };

    function parseForm(form) {
      var values = {};
      for (var element, i = 0; element = form.elements[i]; ++i) {
        switch (element.tagName) {
          case 'INPUT':
            break;
          default:
            continue;
        }
        switch (element.type) {
          case 'checkbox':
          case 'radio':
            if (element.checked) values[element.name] = element.value;
            break;
          default:
            values[element.name] = element.value;
        }
      }
      return values;
    }

    function updateForm(form, values, attrs) {
      for (var element, i = 0; element = form.elements[i]; ++i) {
        switch (element.tagName) {
          case 'INPUT':
            break;
          default:
            continue;
        }
        switch (element.type) {
          case 'checkbox':
          case 'radio':
            element.checked = values[element.name] == element.value;
            break;
          default:
            element.value = values[element.name];
        }
        var attributes = attrs && attrs[element.id] || {};
        for (var name in attributes) {
          switch (attributes[name]) {
            case true:
              element.setAttribute(name, '');
              break;
            case false:
            case null:
            case undefined:
              element.removeAttribute(name);
              break;
            default:
              element.setAttribute(name, attributes[name]);
          }
        }
      }
    }

    function rerender(form) {
      var values = parseForm(form), attrs = {};
      calculateTax(values, attrs);
      formatValues(values);
      updateForm(form, values, attrs);
    }

    function calculateTax(values, attrs) {
      var rate = rates[values['plan']][values['status']];

      attrs = attrs || {};
      attrs['deduction'] = {'disabled': values['deduction-type'] === 'standard'};
      attrs['dependents'] = {'min': values['status'] == 'joint' ? 2 : 1};

      // deduction
      if (values['deduction-type'] === 'standard') {
        values['deduction'] = rate['deduction'];
        attrs['deduction'] = {'type': null, 'min': null, 'step': null, 'disabled': true};
      } else {
        attrs['deduction'] = {'type': 'number', 'min': 0, 'step': 1000, 'disabled': false};
      }

      // exemption
      if (values['dependents'] < attrs['dependents']['min']) {
        values['dependents'] = attrs['dependents']['min'];
      }
      values['exemption'] = values['dependents'] * rate['exemption'];

      // taxable income
      values['taxable-income'] = values['income'];
      values['taxable-income'] -= values['deduction'];
      values['taxable-income'] -= values['exemption'];
      values['taxable-income'] = Math.max(0, values['taxable-income']);

      // tax
      values['tax'] = 0;
      for (var bracket, i = 0; bracket = rate['income'][i]; ++i) {
        if (values['taxable-income'] > bracket.max) {
          values['tax'] += (bracket.max - bracket.min) * bracket.rate;
        } else {
          values['tax'] += (values['taxable-income'] - bracket.min) * bracket.rate;
          break;
        }
      }
    }

    function formatValues(values) {
      for (var name in values) {
        if (typeof values[name] === 'number') {
          values[name] = values[name].toFixed();
        } else {
          values[name] = values[name] || '';
        }
      }
    }

    for (var form, i = 0; form = document.forms[i]; ++i) {
      form.onchange = form.oninput = function(event) { rerender(event.currentTarget) };
    }
  </script>
</body>
